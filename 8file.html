<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Levi’s Course Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f1220;
      --card: #171a2b;
      --muted: #aab2d5;
      --text: #e8ecff;
      --accent: #6ea8ff;
      --accent-2: #9ef0c0;
      --warn: #ffd166;
      --danger: #ff6b6b;
      --border: #2a2f4a;
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans"; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .app { max-width: 1100px; margin: 0 auto; padding: 20px; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 18px; }
    header h1 { font-size: 20px; margin: 0; letter-spacing: 0.2px; color: #f2f4ff; }
    .controls { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .btn {
      background: var(--card); color: var(--text); border: 1px solid var(--border); padding: 8px 12px; border-radius: 8px; cursor: pointer;
    }
    .btn.active { outline: 2px solid var(--accent); }
    .select, .search { appearance: none; background: var(--card); color: var(--text); border: 1px solid var(--border); padding: 8px 12px; border-radius: 8px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 880px) { .grid { grid-template-columns: 1fr; } }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
    .section-title { font-size: 14px; color: var(--muted); margin: 0 0 8px 0; letter-spacing: 0.3px; }
    .task { display: grid; grid-template-columns: auto 1fr auto; align-items: start; gap: 10px; padding: 10px; border-radius: 8px; border: 1px solid transparent; }
    .task + .task { margin-top: 6px; }
    .task:hover { background: rgba(255,255,255,0.02); border-color: var(--border); }
    .task .title { font-weight: 600; color: #f6f8ff; }
    .task .meta { color: var(--muted); font-size: 12px; margin-top: 2px; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 11px; font-weight: 600; letter-spacing: 0.3px; }
    .pill.math { background: rgba(110,168,255,0.15); color: #bcd6ff; border: 1px solid rgba(110,168,255,0.4); }
    .pill.comp { background: rgba(158,240,192,0.15); color: #baf3d3; border: 1px solid rgba(158,240,192,0.4); }
    .pill.hist { background: rgba(255,209,102,0.15); color: #ffe3a6; border: 1px solid rgba(255,209,102,0.4); }
    .due { font-size: 12px; color: var(--muted); }
    .due .when { color: #fff; }
    .overdue { color: var(--danger); font-weight: 600; }
    .soon { color: var(--warn); font-weight: 600; }
    .ok { color: var(--accent-2); font-weight: 600; }
    .muted { color: var(--muted); }
    .small { font-size: 12px; }
    .calendar { background: var(--card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .cal-header { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-bottom: 1px solid var(--border); }
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--border); }
    .cal-grid .dow { background: #1d2136; color: var(--muted); text-align: center; padding: 8px 0; font-size: 12px; }
    .cal-cell { background: var(--card); min-height: 100px; padding: 6px; position: relative; }
    .cal-date { position: absolute; top: 6px; right: 8px; font-size: 11px; color: var(--muted); }
    .cal-events { margin-top: 18px; display: flex; flex-direction: column; gap: 4px; }
    .cal-evt { font-size: 11px; padding: 2px 6px; border-radius: 6px; border: 1px solid var(--border); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .cal-evt.math { background: rgba(110,168,255,0.12); }
    .cal-evt.comp { background: rgba(158,240,192,0.12); }
    .cal-evt.hist { background: rgba(255,209,102,0.12); }
    .strike { text-decoration: line-through; opacity: 0.7; }
    .link { color: var(--accent); }

    /* Schedule view */
    .toolbar { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
    .schedule { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
    .day-picker { display: flex; align-items: center; gap: 6px; }
    .slot { display: grid; grid-template-columns: 90px 1fr auto; gap: 10px; padding: 10px; border-radius: 8px; border: 1px solid transparent; }
    .slot + .slot { margin-top: 6px; }
    .slot:hover { background: rgba(255,255,255,0.02); border-color: var(--border); }
    .slot .time { color: #fff; font-weight: 600; }
    .slot .title { font-weight: 600; }
    .slot .sub { color: var(--muted); font-size: 12px; margin-top: 2px; }
    .blockline { height: 6px; border-radius: 6px; background: #273054; margin-top: 6px; }
    .blockline.math { background: linear-gradient(90deg, #2a7bff, #235ddb); }
    .blockline.comp { background: linear-gradient(90deg, #1bbf7a, #0f9b5a); }
    .blockline.hist { background: linear-gradient(90deg, #ffc14f, #e39f1b); }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Levi’s Course Dashboard</h1>
      <div class="controls">
        <select id="courseFilter" class="select" title="Filter by course">
          <option value="all">All courses</option>
          <option value="math">College Algebra</option>
          <option value="comp">Composition</option>
          <option value="hist">US History</option>
        </select>
        <input id="searchBox" class="search" placeholder="Search…" />
        <button id="btnDashboard" class="btn active">Upcoming</button>
        <button id="btnSchedule" class="btn">Schedule</button>
        <button id="btnCalendar" class="btn">Calendar</button>
      </div>
    </header>

    <!-- UPCOMING -->
    <div id="dashboardView" class="grid" role="region" aria-label="Upcoming tasks">
      <section class="card">
        <h2 class="section-title">Due This Week</h2>
        <div id="listThisWeek"></div>
      </section>
      <section class="card">
        <h2 class="section-title">Next Up</h2>
        <div id="listNextUp"></div>
      </section>
      <section class="card" style="grid-column: 1 / -1;">
        <div class="section-title">Completed</div>
        <div id="listDone"></div>
      </section>
    </div>

    <!-- SCHEDULE -->
    <div id="scheduleView" class="schedule" style="display:none;" role="region" aria-label="Planned schedule">
      <div class="toolbar">
        <div class="day-picker">
          <button id="prevDay" class="btn">Prev Day</button>
          <div id="dayLabel" class="small muted" style="min-width: 180px; text-align:center;"></div>
          <button id="nextDay" class="btn">Next Day</button>
          <button id="todayDay" class="btn">Today</button>
        </div>
        <div class="spacer"></div>
        <div class="legend">
          <span class="pill math">Algebra</span>
          <span class="pill comp">Composition</span>
          <span class="pill hist">US History</span>
        </div>
      </div>
      <div id="slotList"></div>
      <p class="small muted" style="margin-top:8px;">Tip: edit the scheduleBlocks array in the code to adjust times or add blocks.</p>
    </div>

    <!-- CALENDAR -->
    <div id="calendarView" class="calendar" style="display:none;">
      <div class="cal-header">
        <div class="legend">
          <span class="pill math">Algebra</span>
          <span class="pill comp">Composition</span>
          <span class="pill hist">US History</span>
        </div>
        <div class="row">
          <button id="prevMonth" class="btn">Prev</button>
          <div id="calLabel" class="small muted" style="min-width: 160px; text-align:center;"></div>
          <button id="nextMonth" class="btn">Next</button>
          <button id="todayBtn" class="btn">Today</button>
        </div>
      </div>
      <div class="cal-grid" id="calGridDOW"></div>
      <div class="cal-grid" id="calGrid"></div>
    </div>
  </div>

  <script>
    // Utility
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const fmt = (d) => d.toLocaleString(undefined, { month: 'short', day: 'numeric' });
    const fmtTime = (d) => d.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
    const startOfDay = d => new Date(d.getFullYear(), d.getMonth(), d.getDate());
    const endOfDay = d => new Date(d.getFullYear(), d.getMonth(), d.getDate(), 23, 59, 59);
    const inSameWeek = (d, ref = new Date()) => {
      const day = new Date(ref);
      const dow = day.getDay(); // 0 Sun
      const weekStart = new Date(day); weekStart.setDate(day.getDate() - dow);
      const weekEnd = new Date(weekStart); weekEnd.setDate(weekStart.getDate() + 6);
      return d >= startOfDay(weekStart) && d <= endOfDay(weekEnd);
    };
    const isSoon = (d) => {
      const now = new Date();
      const diff = (d - now) / (1000*60*60);
      return diff <= 48 && diff >= 0;
    };
    const isOverdue = (d) => d < new Date();

    // TASKS (Upcoming)
    const seedTasks = [
      { id: 'hw12', title: 'HW 1.2 Integer Exponents', course: 'math', due: '2025-08-31T23:59:00', url: 'https://cedarville.instructure.com/courses/25243/assignments/498419' },
      { id: 'hw13', title: 'HW 1.3 Rational Exponents', course: 'math', due: '2025-08-31T23:59:00', url: 'https://cedarville.instructure.com/courses/25243/assignments/498432' },
      { id: 'hw14', title: 'HW 1.4 Polynomials', course: 'math', due: '2025-08-31T23:59:00', url: 'https://cedarville.instructure.com/courses/25243/assignments/498447' },
      { id: 'compForm', title: 'Formative Essay: Establishing a Baseline', course: 'comp', due: '2025-08-31T23:59:00', url: 'https://cedarville.instructure.com/courses/25136/assignments/496849' },
      { id: 'histQ1', title: 'US History Chapter 1 Quiz', course: 'hist', due: '2025-09-03T23:59:00', url: 'https://cedarville.instructure.com/courses/25307/pages/unit-1-overview?module_item_id=1399568' },
      { id: 'histQ2', title: 'US History Chapter 2 Quiz', course: 'hist', due: '2025-09-03T23:59:00', url: 'https://cedarville.instructure.com/courses/25307/pages/unit-1-overview?module_item_id=1399568' },
      { id: 'm1Written', title: 'Module 1 Written Work (Q38 upload)', course: 'math', due: '2025-09-07T23:59:00', url: 'https://cedarville.instructure.com/courses/25243/assignments/498829' },
      { id: 'm1Disc', title: 'Group Discussion: God and Mathematics', course: 'math', due: '2025-09-07T23:59:00', url: 'https://cedarville.instructure.com/courses/25243/discussion_topics/255361' },
      { id: 'exam1', title: 'Exam 1 (1.1–1.4) Remotely Proctored', course: 'math', due: '2025-09-07T23:59:00', url: 'https://cedarville.instructure.com/courses/25243/quizzes/89558' },
      { id: 'compAppraise', title: 'Researched Argument BA #1: Appraise the Project', course: 'comp', due: '2025-09-07T23:59:00', url: 'https://cedarville.instructure.com/courses/25136/pages/instructions-for-researched-argument-building-assignment-1-appraising-the-project-2?module_item_id=1397002' },
      { id: 'histTheme', title: 'US History: Capstone Theme Choice', course: 'hist', due: '2025-09-07T23:59:00', url: 'https://cedarville.instructure.com/courses/25307/pages/capstone-paper-themes?module_item_id=1399581' },
      { id: 'hw11', title: 'HW 1.1 Real Numbers — Done 98.84%', course: 'math', due: '2025-08-31T23:59:00', url: 'https://cedarville.instructure.com/courses/25243/assignments/498407', done: true }
    ];
    const STORAGE_KEY = 'levi_dashboard_tasks_v1';
    let tasks = loadTasks();

    function loadTasks() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try {
          const parsed = JSON.parse(raw);
          const byId = new Map(parsed.map(t => [t.id, t]));
          seedTasks.forEach(s => { if (!byId.has(s.id)) parsed.push(s); });
          return parsed;
        } catch (_) {}
      }
      localStorage.setItem(STORAGE_KEY, JSON.stringify(seedTasks));
      return structuredClone(seedTasks);
    }
    function saveTasks() { localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }

    function getFilter() { return $('#courseFilter').value; }
    function getQuery() { return ($('#searchBox').value || '').toLowerCase(); }
    function passFilterCourseAndQuery(item) {
      const f = getFilter();
      const q = getQuery();
      const courseOK = (f === 'all' || item.course === f);
      const text = (item.title || item.label || '').toLowerCase();
      const textOK = !q || text.includes(q);
      return courseOK && textOK;
    }

    function coursePill(c) {
      if (c === 'math') return '<span class="pill math">Algebra</span>';
      if (c === 'comp') return '<span class="pill comp">Composition</span>';
      if (c === 'hist') return '<span class="pill hist">US History</span>';
      return '';
    }
    function dueBadge(due) {
      const d = new Date(due);
      if (isOverdue(d)) return `<span class="overdue">Overdue</span>`;
      if (isSoon(d)) return `<span class="soon">Soon</span>`;
      return `<span class="ok">Scheduled</span>`;
    }

    function renderTask(t) {
      const d = new Date(t.due);
      const link = t.url ? ` • <a class="link" href="${t.url}" target="_blank" rel="noopener">Open</a>` : '';
      return `
        <div class="task">
          <div><input type="checkbox" data-id="${t.id}" ${t.done ? 'checked' : ''} aria-label="Mark complete"/></div>
          <div>
            <div class="title ${t.done ? 'strike' : ''}">${t.title}</div>
            <div class="meta">${coursePill(t.course)} ${link}</div>
          </div>
          <div class="due" title="${d.toString()}">
            <div class="when">${fmt(d)} • ${fmtTime(d)}</div>
            <div>${dueBadge(d)}</div>
          </div>
        </div>
      `;
    }

    function renderLists() {
      const now = new Date();
      const thisWeek = tasks.filter(t => !t.done && inSameWeek(new Date(t.due), now) && passFilterCourseAndQuery(t))
        .sort((a,b) => new Date(a.due) - new Date(b.due));
      const nextUp = tasks.filter(t => !t.done && !inSameWeek(new Date(t.due), now) && passFilterCourseAndQuery(t))
        .sort((a,b) => new Date(a.due) - new Date(b.due));
      const done = tasks.filter(t => t.done && passFilterCourseAndQuery(t))
        .sort((a,b) => new Date(b.completedAt || 0) - new Date(a.completedAt || 0));

      $('#listThisWeek').innerHTML = thisWeek.length ? thisWeek.map(renderTask).join('') : `<div class="muted small">No tasks due this week.</div>`;
      $('#listNextUp').innerHTML = nextUp.length ? nextUp.slice(0, 8).map(renderTask).join('') : `<div class="muted small">Nothing queued after this week.</div>`;
      $('#listDone').innerHTML = done.length ? done.slice(0, 10).map(renderTask).join('') : `<div class="muted small">No completed tasks yet.</div>`;

      $$('#dashboardView input[type="checkbox"][data-id]').forEach(cb => {
        cb.addEventListener('change', (e) => {
          const id = e.target.getAttribute('data-id');
          const t = tasks.find(x => x.id === id);
          if (t) {
            t.done = e.target.checked;
            t.completedAt = t.done ? new Date().toISOString() : null;
            saveTasks(); renderLists(); renderCalendar();
          }
        });
      });
    }

    // CALENDAR
    const calDOW = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    let calRef = new Date();
    function renderCalendarDOW() { $('#calGridDOW').innerHTML = calDOW.map(d => `<div class="dow">${d}</div>`).join(''); }
    function renderCalendar() {
      const y = calRef.getFullYear();
      const m = calRef.getMonth();
      const first = new Date(y, m, 1);
      const startIdx = first.getDay();
      const daysInMonth = new Date(y, m+1, 0).getDate();
      const cells = [];
      for (let i = 0; i < startIdx; i++) cells.push({ blank: true });
      for (let d = 1; d <= daysInMonth; d++) {
        const dayDate = new Date(y, m, d);
        const dayTasks = tasks.filter(t => {
          const td = new Date(t.due);
          return td.getFullYear() === y && td.getMonth() === m && td.getDate() === d && passFilterCourseAndQuery(t);
        }).sort((a,b) => new Date(a.due) - new Date(b.due));
        cells.push({ date: dayDate, items: dayTasks });
      }
      while (cells.length % 7 !== 0) cells.push({ blank: true });
      $('#calLabel').textContent = calRef.toLocaleString(undefined, { month: 'long', year: 'numeric' });
      $('#calGrid').innerHTML = cells.map(cell => {
        if (cell.blank) return `<div class="cal-cell"></div>`;
        const dt = cell.date;
        const evts = cell.items.slice(0, 4).map(ev => `
          <div class="cal-evt ${ev.course}" title="${ev.title} — ${fmtTime(new Date(ev.due))}${ev.done ? ' (Done)' : ''}">
            ${ev.done ? '✓ ' : ''}${ev.title.length > 28 ? ev.title.slice(0, 28)+'…' : ev.title}
          </div>
        `).join('');
        return `
          <div class="cal-cell">
            <div class="cal-date">${dt.getDate()}</div>
            <div class="cal-events">${evts || ''}</div>
          </div>
        `;
      }).join('');
    }

    // SCHEDULE BLOCKS (minute-by-minute)
    // Edit the times/labels below as you like.
    const scheduleBlocks = [
      // Wednesday Aug 27, 2025 (example timeline based on our plan)
      { date: '2025-08-27', start: '09:00', end: '09:05', label: 'Setup: DND on, Canvas full screen, scratch ready', course: 'math' },
      { date: '2025-08-27', start: '09:05', end: '09:55', label: 'HW 1.2 — pass 1 (fast to slow, 2-min rule)', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/assignments/498419' },
      { date: '2025-08-27', start: '09:55', end: '10:05', label: 'Break', course: 'math' },
      { date: '2025-08-27', start: '10:05', end: '10:45', label: 'HW 1.2 — finish and submit', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/assignments/498419' },
      { date: '2025-08-27', start: '10:45', end: '10:55', label: 'Break', course: 'math' },
      { date: '2025-08-27', start: '10:55', end: '11:35', label: 'HW 1.3 — pass 1 (rational exponents, exact forms)', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/assignments/498432' },
      { date: '2025-08-27', start: '11:35', end: '11:45', label: 'Note sticky types for quick review', course: 'math' },
      { date: '2025-08-27', start: '11:45', end: '12:30', label: 'Lunch', course: 'math' },
      { date: '2025-08-27', start: '12:30', end: '12:45', label: 'Targeted refresh 1.3 misses (e-text/video snippets)', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/pages/module-1-overview?module_item_id=1400587' },
      { date: '2025-08-27', start: '12:45', end: '13:25', label: 'HW 1.3 — finish and submit', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/assignments/498432' },
      { date: '2025-08-27', start: '13:25', end: '13:35', label: 'Break', course: 'comp' },
      { date: '2025-08-27', start: '13:35', end: '14:05', label: 'Watch Composition intro + Importance of Words', course: 'comp', url: 'https://cedarville.instructure.com/courses/25136/pages/introduction-video-cyndi-messer?module_item_id=1396982' },
      { date: '2025-08-27', start: '14:05', end: '14:55', label: 'Formative Essay — draft 600–700 words', course: 'comp', url: 'https://cedarville.instructure.com/courses/25136/assignments/496849' },
      { date: '2025-08-27', start: '14:55', end: '15:05', label: 'Break', course: 'hist' },
      { date: '2025-08-27', start: '15:05', end: '15:25', label: 'US History Videos — Lectures 1–2', course: 'hist', url: 'https://cedarville.instructure.com/courses/25307/pages/unit-1-video-lectures?module_item_id=1399574' },
      { date: '2025-08-27', start: '15:25', end: '15:45', label: 'US History Videos — Lecture 3', course: 'hist', url: 'https://cedarville.instructure.com/courses/25307/pages/unit-1-video-lectures?module_item_id=1399574' },
      { date: '2025-08-27', start: '15:45', end: '16:00', label: 'Email Dr. Hammett about Exam 1 date/proctoring', course: 'math', url: 'mailto:ahammett@cedarville.edu' },

      // Thursday Aug 28, 2025
      { date: '2025-08-28', start: '09:00', end: '09:05', label: 'Setup', course: 'math' },
      { date: '2025-08-28', start: '09:05', end: '09:55', label: 'HW 1.4 — pass 1 (polynomials)', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/assignments/498447' },
      { date: '2025-08-28', start: '09:55', end: '10:05', label: 'Break', course: 'math' },
      { date: '2025-08-28', start: '10:05', end: '10:35', label: 'HW 1.4 — finish and submit', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/assignments/498447' },
      { date: '2025-08-28', start: '10:35', end: '10:45', label: 'Break', course: 'comp' },
      { date: '2025-08-28', start: '10:45', end: '11:25', label: 'Formative Essay — expand to 900–1100 words', course: 'comp', url: 'https://cedarville.instructure.com/courses/25136/assignments/496849' },
      { date: '2025-08-28', start: '11:25', end: '11:45', label: 'Tighten and submit Formative Essay', course: 'comp', url: 'https://cedarville.instructure.com/courses/25136/assignments/496849' },
      { date: '2025-08-28', start: '11:45', end: '12:30', label: 'Lunch', course: 'comp' },
      { date: '2025-08-28', start: '12:40', end: '13:00', label: 'Module 1 Written Work — read Q38, plan', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/assignments/498829' },
      { date: '2025-08-28', start: '13:00', end: '13:30', label: 'Module 1 Written Work — solve neatly', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/assignments/498829' },
      { date: '2025-08-28', start: '13:30', end: '13:45', label: 'Scan/upload PDF', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/assignments/498829' },
      { date: '2025-08-28', start: '13:55', end: '14:25', label: 'US History Videos — Lectures 4–5', course: 'hist', url: 'https://cedarville.instructure.com/courses/25307/pages/unit-1-video-lectures?module_item_id=1399574' },
      { date: '2025-08-28', start: '14:25', end: '14:45', label: 'Unit 1 Overview — outline Ch 1–2', course: 'hist', url: 'https://cedarville.instructure.com/courses/25307/pages/unit-1-overview?module_item_id=1399568' },
      { date: '2025-08-28', start: '14:45', end: '15:05', label: 'Draft 120–180 words: God and Mathematics post', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/discussion_topics/255361' },
      { date: '2025-08-28', start: '15:05', end: '15:45', label: 'Comp: Appraise the Project — brainstorm top 3 + pros/cons', course: 'comp', url: 'https://cedarville.instructure.com/courses/25136/pages/instructions-for-researched-argument-building-assignment-1-appraising-the-project-2?module_item_id=1397002' },

      // Friday Aug 29, 2025 (buffer if needed)
      { date: '2025-08-29', start: '09:00', end: '09:30', label: 'US History — Chapter 1 Quiz', course: 'hist', url: 'https://cedarville.instructure.com/courses/25307/pages/unit-1-overview?module_item_id=1399568' },
      { date: '2025-08-29', start: '09:35', end: '10:05', label: 'US History — Chapter 2 Quiz', course: 'hist', url: 'https://cedarville.instructure.com/courses/25307/pages/unit-1-overview?module_item_id=1399568' },
      { date: '2025-08-29', start: '10:15', end: '10:35', label: 'Post: God and Mathematics discussion', course: 'math', url: 'https://cedarville.instructure.com/courses/25243/discussion_topics/255361' },
      { date: '2025-08-29', start: '10:45', end: '11:30', label: 'Comp: Appraise the Project — select topic + alternate', course: 'comp', url: 'https://cedarville.instructure.com/courses/25136/pages/instructions-for-researched-argument-building-assignment-1-appraising-the-project-2?module_item_id=1397002' }
    ];

    let dayRef = new Date();
    function setDayRef(d) {
      dayRef = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    }
    function getDayKey(d) {
      return d.toISOString().slice(0,10);
    }
    function renderSchedule() {
      $('#dayLabel').textContent = dayRef.toLocaleDateString(undefined, { weekday: 'long', month: 'short', day: 'numeric' });
      const key = getDayKey(dayRef);
      const blocks = scheduleBlocks
        .filter(b => b.date === key && passFilterCourseAndQuery({ course: b.course, title: b.label }))
        .sort((a,b) => a.start.localeCompare(b.start));
      $('#slotList').innerHTML = blocks.length ? blocks.map(renderSlot).join('') : `<div class="muted small">No blocks scheduled for this day.</div>`;
    }
    function renderSlot(b) {
      const link = b.url ? ` • <a class="link" href="${b.url}" target="_blank" rel="noopener">Open</a>` : '';
      return `
        <div class="slot">
          <div class="time">${b.start}–${b.end}</div>
          <div>
            <div class="title">${b.label} ${link}</div>
            <div class="sub">${coursePill(b.course)}</div>
            <div class="blockline ${b.course}"></div>
          </div>
          <div></div>
        </div>
      `;
    }

    // View toggles
    function showDashboard() {
      $('#dashboardView').style.display = '';
      $('#scheduleView').style.display = 'none';
      $('#calendarView').style.display = 'none';
      $('#btnDashboard').classList.add('active');
      $('#btnSchedule').classList.remove('active');
      $('#btnCalendar').classList.remove('active');
    }
    function showSchedule() {
      $('#dashboardView').style.display = 'none';
      $('#scheduleView').style.display = '';
      $('#calendarView').style.display = 'none';
      $('#btnDashboard').classList.remove('active');
      $('#btnSchedule').classList.add('active');
      $('#btnCalendar').classList.remove('active');
      renderSchedule();
    }
    function showCalendar() {
      $('#dashboardView').style.display = 'none';
      $('#scheduleView').style.display = 'none';
      $('#calendarView').style.display = '';
      $('#btnDashboard').classList.remove('active');
      $('#btnSchedule').classList.remove('active');
      $('#btnCalendar').classList.add('active');
      renderCalendarDOW();
      renderCalendar();
    }

    // Init
    function init() {
      $('#btnDashboard').addEventListener('click', showDashboard);
      $('#btnSchedule').addEventListener('click', showSchedule);
      $('#btnCalendar').addEventListener('click', showCalendar);

      $('#courseFilter').addEventListener('change', () => { renderLists(); renderCalendar(); renderSchedule(); });
      $('#searchBox').addEventListener('input', () => { renderLists(); renderCalendar(); renderSchedule(); });

      $('#prevMonth').addEventListener('click', () => { calRef.setMonth(calRef.getMonth()-1); renderCalendar(); });
      $('#nextMonth').addEventListener('click', () => { calRef.setMonth(calRef.getMonth()+1); renderCalendar(); });
      $('#todayBtn').addEventListener('click', () => { calRef = new Date(); renderCalendar(); });

      $('#prevDay').addEventListener('click', () => { dayRef.setDate(dayRef.getDate()-1); renderSchedule(); });
      $('#nextDay').addEventListener('click', () => { dayRef.setDate(dayRef.getDate()+1); renderSchedule(); });
      $('#todayDay').addEventListener('click', () => { setDayRef(new Date()); renderSchedule(); });

      renderLists();
      renderCalendarDOW();
      renderCalendar();
      setDayRef(new Date());
      renderSchedule();
    }
    init();
  </script>
</body>
</html>